<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microclimate Simulator</title>
    <script type="importmap">
    {
      "imports": {
        "react/": "https://esm.sh/react@^19.1.1/"
      }
    }
    </script>
    <link rel="stylesheet" href="/index.css">
</head>
<body>
    <div class="header">
        <h1>
            <span class="icon icon-globe" aria-hidden="true">
                <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                    <path
                        fill="currentColor"
                        d="M12 2.5a9.5 9.5 0 1 1 0 19 9.5 9.5 0 0 1 0-19Zm0 2a7.5 7.5 0 0 0-6.37 11.42c.65-1.45 2.43-2.17 4.69-2.17 2.68 0 4.86 1.13 5.15 3.13A7.5 7.5 0 0 0 12 4.5Zm-6.7 9.2A7.5 7.5 0 0 0 15.6 5.35c-.55.78-1.43 1.26-2.47 1.26-1.24 0-2.16-.54-3.05-1.08-.79-.47-1.58-.94-2.48-.94-.6 0-1.14.17-1.61.47A7.46 7.46 0 0 0 5.3 13.7ZM12 19.5c1.45 0 2.82-.35 4.02-.97-.1-1.33-1.54-2.53-4.02-2.53s-3.92 1.2-4.02 2.53A8.47 8.47 0 0 0 12 19.5Z"
                    ></path>
                </svg>
            </span>
            Interactive Microclimate Simulator
        </h1>
        <p class="tagline">Design terrain and land cover, then simulate realistic temperature patterns</p>
    </div>

    <div class="main-container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
            <div id="tooltip"></div>
        </div>

        <aside class="controls">
            <div class="control-accordion">
                <details class="control-section" open>
                    <summary>
                        <span class="summary-content">
                            <span class="icon icon-simulation" aria-hidden="true">
                                <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                                    <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="1.5"></circle>
                                    <path fill="currentColor" d="M11 9.5v5l4-2.5-4-2.5Z"></path>
                                </svg>
                            </span>
                            <span class="accordion-title">Simulation Control</span>
                        </span>
                        <span class="accordion-indicator" aria-hidden="true"></span>
                    </summary>
                    <div class="control-content">
                        <div class="time-display">
                            <span id="simDay">Day 1</span>, <span id="simTime">06:00</span>
                        </div>
                        <div class="control-group">
                            <label>Simulation Speed: <span class="range-value" id="speedValue">1x</span></label>
                            <input type="range" id="simSpeed" min="1" max="60" value="10" step="1">
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="createScenarioBtn">
                                <span class="icon icon-scenario" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                                        <path
                                            fill="currentColor"
                                            d="M4 18.5h16a1 1 0 0 0 .9-1.45l-2.68-5.36a1 1 0 0 0-1.63-.22l-2.41 2.42-3.39-5.43a1 1 0 0 0-1.7-.02L3.12 17.04A1 1 0 0 0 4 18.5Z"
                                        ></path>
                                    </svg>
                                </span>
                                <span class="btn-label">Create Scenario</span>
                            </button>
                            <button class="btn btn-secondary" id="playPauseBtn">
                                <span class="icon icon-play" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                                        <path fill="currentColor" d="M9 7v10l8-5-8-5Z"></path>
                                    </svg>
                                </span>
                                <span class="btn-label">Play</span>
                            </button>
                            <button class="btn btn-secondary" id="resetBtn">
                                <span class="icon icon-reset" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                                        <path
                                            fill="currentColor"
                                            d="M12 5a7 7 0 1 1-6.32 9.97l1.38-.8A5 5 0 1 0 12 7v2.5l-4-2.5L12 4.5V5Z"
                                        ></path>
                                    </svg>
                                </span>
                                <span class="btn-label">Reset</span>
                            </button>
                        </div>
                    </div>
                </details>

                <details class="control-section">
                    <summary>
                        <span class="summary-content">
                            <span class="icon icon-editing" aria-hidden="true">
                                <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                                    <path
                                        fill="currentColor"
                                        d="M15.95 4.55a1.5 1.5 0 0 1 2.12 0l1.38 1.38a1.5 1.5 0 0 1 0 2.12l-9.2 9.2-4.2.74.74-4.2 9.16-9.24Z"
                                    ></path>
                                    <path fill="currentColor" d="M5 19h14v1.5H5z" opacity="0.4"></path>
                                </svg>
                            </span>
                            <span class="accordion-title">Editing Tools</span>
                        </span>
                        <span class="accordion-indicator" aria-hidden="true"></span>
                    </summary>
                    <div class="control-content">
                        <div class="control-group">
                            <label>Brush Category</label>
                            <select id="brushCategory">
                                <option value="terrain">Terrain &amp; Land Cover</option>
                                <option value="soil">Soil Types</option>
                            </select>
                        </div>

                        <div class="control-group" id="terrainBrushes">
                            <label>Land Cover Type</label>
                            <div class="brush-buttons">
                                <button class="brush-btn active" data-brush="terrain" data-category="terrain">
                                    <span class="icon icon-swatch icon-terrain" aria-hidden="true"></span>
                                    <span class="btn-label">Terrain</span>
                                </button>
                                <button class="brush-btn" data-brush="water" data-category="land">
                                    <span class="icon icon-swatch icon-water" aria-hidden="true"></span>
                                    <span class="btn-label">Water</span>
                                </button>
                                <button class="brush-btn" data-brush="forest" data-category="land">
                                    <span class="icon icon-swatch icon-forest" aria-hidden="true"></span>
                                    <span class="btn-label">Forest</span>
                                </button>
                                <button class="brush-btn" data-brush="urban" data-category="land">
                                    <span class="icon icon-swatch icon-urban" aria-hidden="true"></span>
                                    <span class="btn-label">Urban</span>
                                </button>
                                <button class="brush-btn" data-brush="settlement" data-category="land">
                                    <span class="icon icon-swatch icon-settlement" aria-hidden="true"></span>
                                    <span class="btn-label">Settlement</span>
                                </button>
                                <button class="brush-btn" data-brush="grassland" data-category="land">
                                    <span class="icon icon-swatch icon-grass" aria-hidden="true"></span>
                                    <span class="btn-label">Grassland</span>
                                </button>
                                <button class="brush-btn" data-brush="manualPrecipitation" data-category="action">
                                    <span class="icon icon-swatch icon-precipitation" aria-hidden="true"></span>
                                    <span class="btn-label">Precipitation</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-group" id="soilBrushes" style="display: none;">
                            <label>Soil Type</label>
                            <div class="brush-buttons">
                                <button class="brush-btn" data-brush="loam" data-category="soil">
                                    <span class="icon icon-swatch icon-loam" aria-hidden="true"></span>
                                    <span class="btn-label">Loam</span>
                                </button>
                                <button class="brush-btn" data-brush="sand" data-category="soil">
                                    <span class="icon icon-swatch icon-sand" aria-hidden="true"></span>
                                    <span class="btn-label">Sand</span>
                                </button>
                                <button class="brush-btn" data-brush="clay" data-category="soil">
                                    <span class="icon icon-swatch icon-clay" aria-hidden="true"></span>
                                    <span class="btn-label">Clay</span>
                                </button>
                                <button class="brush-btn" data-brush="rock" data-category="soil">
                                    <span class="icon icon-swatch icon-rock" aria-hidden="true"></span>
                                    <span class="btn-label">Rock</span>
                                </button>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>Brush Size: <span class="range-value" id="brushSizeValue">15</span></label>
                            <input type="range" id="brushSize" min="5" max="50" value="15">
                        </div>

                        <div class="control-group" id="terrainStrengthGroup">
                            <label>Terrain Strength: <span class="range-value" id="terrainStrengthValue">5</span></label>
                            <input type="range" id="terrainStrength" min="1" max="20" value="5">
                        </div>
                    </div>
                </details>

                <details class="control-section">
                    <summary>
                        <span class="summary-content">
                            <span class="icon icon-climate" aria-hidden="true">
                                <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                                    <path
                                        fill="currentColor"
                                        d="M12 3a2.5 2.5 0 0 0-2.5 2.5v8.32a4 4 0 1 0 5 3.85 4 4 0 0 0-1.5-3.17V5.5A2.5 2.5 0 0 0 12 3Zm0 2a.5.5 0 0 1 .5.5v8.9l.34.22a2.5 2.5 0 1 1-3.68 2.18c0-.9.45-1.73 1.2-2.2l.34-.22V5.5A.5.5 0 0 1 12 5Z"
                                    ></path>
                                </svg>
                            </span>
                            <span class="accordion-title">Climate Settings</span>
                        </span>
                        <span class="accordion-indicator" aria-hidden="true"></span>
                    </summary>
                    <div class="control-content">
                        <div class="control-group">
                            <label>Month</label>
                            <select id="month">
                                <option value="1">January (Winter)</option>
                                <option value="2">February (Winter)</option>
                                <option value="3">March (Spring)</option>
                                <option value="4">April (Spring)</option>
                                <option value="5">May (Spring)</option>
                                <option value="6">June (Summer)</option>
                                <option value="7" selected>July (Summer)</option>
                                <option value="8">August (Summer)</option>
                                <option value="9">September (Fall)</option>
                                <option value="10">October (Fall)</option>
                                <option value="11">November (Fall)</option>
                                <option value="12">December (Winter)</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label>Wind Direction</label>
                            <select id="windDirection">
                                <option value="0" selected>North → South (↓)</option>
                                <option value="45">Northeast → Southwest (↙)</option>
                                <option value="90">East → West (←)</option>
                                <option value="135">Southeast → Northwest (↖)</option>
                                <option value="180">South → North (↑)</option>
                                <option value="225">Southwest → Northeast (↗)</option>
                                <option value="270">West → East (→)</option>
                                <option value="315">Northwest → Southeast (↘)</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label>Wind Speed: <span class="range-value" id="windSpeedValue">20</span> km/h</label>
                            <input type="range" id="windSpeed" min="0" max="50" value="20">
                        </div>

                        <div class="control-group">
                            <label>Wind Gustiness: <span class="range-value" id="windGustinessValue">20</span>%</label>
                            <input type="range" id="windGustiness" min="0" max="100" value="20">
                        </div>
                    </div>
                </details>

                <details class="control-section">
                    <summary>
                        <span class="summary-content">
                            <span class="icon icon-visualization" aria-hidden="true">
                                <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                                    <rect x="4" y="5" width="6" height="6" rx="1" fill="currentColor" opacity="0.8"></rect>
                                    <rect x="14" y="5" width="6" height="6" rx="1" fill="currentColor" opacity="0.5"></rect>
                                    <rect x="4" y="13" width="6" height="6" rx="1" fill="currentColor" opacity="0.6"></rect>
                                    <rect x="14" y="13" width="6" height="6" rx="1" fill="currentColor"></rect>
                                </svg>
                            </span>
                            <span class="accordion-title">Visualization</span>
                        </span>
                        <span class="accordion-indicator" aria-hidden="true"></span>
                    </summary>
                    <div class="control-content">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showHeatmap" checked>
                            <label for="showHeatmap">Show Temperature Heatmap</label>
                        </div>
                        <div class="control-group">
                            <label for="heatmapPalette">Heatmap Palette</label>
                            <select id="heatmapPalette">
                                <option value="blue-red" selected>Blue → Red (Blau → Rot)</option>
                                <option value="green-yellow">Green → Yellow (Grün → Gelb)</option>
                                <option value="purple-orange">Purple → Orange (Violett → Orange)</option>
                                <option value="teal-magenta">Teal → Magenta (Türkis → Magenta)</option>
                            </select>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showSoilTypes">
                            <label for="showSoilTypes">Show Soil Types</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showHillshade" checked>
                            <label for="showHillshade">Show Terrain Hillshading</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableAdvection" checked>
                            <label for="enableAdvection">Enable Advection (Wind Transport)</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableDiffusion" checked>
                            <label for="enableDiffusion">Enable Heat Diffusion</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableInversions" checked>
                            <label for="enableInversions">Enable Temperature Inversions</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableDownslope" checked>
                            <label for="enableDownslope">Enable Downslope Winds</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showFog" checked>
                            <label for="showFog">Show Fog/Inversion Layer</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showWindFlow">
                            <label for="showWindFlow">Show Wind Flow Arrows</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableClouds" checked>
                            <label for="enableClouds">Enable Cloud Dynamics</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showClouds" checked>
                            <label for="showClouds">Show Cloud Cover</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showPrecipitation">
                            <label for="showPrecipitation">Show Precipitation</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showHumidity">
                            <label for="showHumidity">Show Relative Humidity</label>
                        </div>
                        <div class="legend legend-single">
                            <div class="legend-item">
                                <div class="legend-color gradient-humidity"></div>
                                <span class="legend-note">Humidity colors: dry → moist → saturated</span>
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showSnowCover" checked>
                            <label for="showSnowCover">Show Snow Cover</label>
                        </div>

                        <div class="stats" id="stats">
                            <div class="stat-row">
                                <span class="stat-label">Min Temperature:</span>
                                <span class="stat-value" id="minTemp">--</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Max Temperature:</span>
                                <span class="stat-value" id="maxTemp">--</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Avg Temperature:</span>
                                <span class="stat-value" id="avgTemp">--</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Precipitation:</span>
                                <span class="stat-value" id="totalPrecip">--</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Max Cloud Height:</span>
                                <span class="stat-value" id="maxCloudHeight">--</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Avg. Snow Depth:</span>
                                <span class="stat-value" id="avgSnowDepth">--</span>
                            </div>
                        </div>

                        <div class="stats inversion" id="inversionInfo" style="display: none;">
                            <div class="stat-row">
                                <span class="stat-label">Inversion Height:</span>
                                <span class="stat-value" id="inversionHeight">--</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Inversion Strength:</span>
                                <span class="stat-value" id="inversionStrength">--</span>
                            </div>
                            <div class="stat-row legend-note-pair">
                                <span class="legend-note"><span class="icon icon-fog" aria-hidden="true"></span>Fog in valleys</span>
                                <span class="legend-note"><span class="icon icon-sunrise" aria-hidden="true"></span>Warm belt on slopes</span>
                            </div>
                        </div>
                    </div>
                </details>

                <details class="control-section">
                    <summary>
                        <span class="summary-content">
                            <span class="icon icon-legend" aria-hidden="true">
                                <svg viewBox="0 0 24 24" role="presentation" focusable="false">
                                    <path
                                        fill="currentColor"
                                        d="M4.5 6.5 11 4l6.5 2.5v11L11 20l-6.5-2.5v-11Zm2 .87v8.66L11 18.5v-8.66L6.5 7.37Zm11 0L13 9.84v8.66l4.5-1.47V7.37Z"
                                    ></path>
                                </svg>
                            </span>
                            <span class="accordion-title">Land Cover Library</span>
                        </span>
                        <span class="accordion-indicator" aria-hidden="true"></span>
                    </summary>
                    <div class="control-content">
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color swatch-water"></div>
                                <span>Water</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color swatch-forest"></div>
                                <span>Forest</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color swatch-urban"></div>
                                <span>Urban Center</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color swatch-settlement"></div>
                                <span>Settlement</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color swatch-grass"></div>
                                <span>Grassland</span>
                            </div>
                        </div>

                        <div class="legend-section">
                            <strong>Soil Types</strong>
                            <div class="legend legend-compact">
                                <div class="legend-item">
                                    <div class="legend-color swatch-loam"></div>
                                    <span>Loam (balanced)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color swatch-sand"></div>
                                    <span>Sand (hot/cold)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color swatch-clay"></div>
                                    <span>Clay (stable)</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color swatch-rock"></div>
                                    <span>Rock (thermal mass)</span>
                                </div>
                            </div>
                        </div>

                        <div class="legend-section">
                            <strong>Soil Properties</strong>
                            <ul class="legend-list">
                                <li><span class="label-strong">Sand:</span> Quick temp changes, poor water retention</li>
                                <li><span class="label-strong">Clay:</span> Stable temps, excellent water retention</li>
                                <li><span class="label-strong">Rock:</span> High thermal mass, minimal moisture</li>
                                <li><span class="label-strong">Loam:</span> Balanced properties, good for plants</li>
                            </ul>
                        </div>

                        <div class="legend-section">
                            <strong>Wind Arrow Colors</strong>
                            <ul class="legend-list">
                                <li><span class="icon icon-dot icon-wind-cold" aria-hidden="true"></span>Blue = Katabatic (cold drainage)</li>
                                <li><span class="icon icon-dot icon-wind-warm" aria-hidden="true"></span>Red = Föhn (warm downslope)</li>
                                <li><span class="icon icon-dot icon-wind-neutral" aria-hidden="true"></span>White = Normal wind flow</li>
                            </ul>
                        </div>

                        <div class="legend-section">
                            <strong>Cloud Types</strong>
                            <ul class="legend-list">
                                <li><span class="icon icon-cloud-cumulus" aria-hidden="true"></span><strong>Cumulus:</strong> Fair weather clouds (afternoon)</li>
                                <li><span class="icon icon-cloud-storm" aria-hidden="true"></span><strong>Cumulonimbus:</strong> Thunderstorms (heavy rain)</li>
                                <li><span class="icon icon-cloud-fog" aria-hidden="true"></span><strong>Stratus:</strong> Low clouds/fog (drizzle)</li>
                                <li><span class="icon icon-cloud-layer" aria-hidden="true"></span><strong>Stratocumulus:</strong> Low lumpy decks from marine layers</li>
                                <li><span class="icon icon-cloud-mountain" aria-hidden="true"></span><strong>Orographic:</strong> Mountain-forced clouds</li>
                                <li><span class="icon icon-cloud-mid" aria-hidden="true"></span><strong>Altostratus:</strong> Widespread mid-level cloud shield</li>
                                <li><span class="icon icon-cloud-mid" aria-hidden="true"></span><strong>Altocumulus:</strong> Mid-level puffs (morning instability)</li>
                                <li><span class="icon icon-cloud-ice" aria-hidden="true"></span><strong>Cirrostratus:</strong> Thin icy veil (sun halo)</li>
                                <li><span class="icon icon-cloud-ice" aria-hidden="true"></span><strong>Cirrus:</strong> High icy streaks</li>
                                <li><span class="icon icon-cloud-rain" aria-hidden="true"></span><strong>Nimbostratus:</strong> Steady stratiform rain or snow</li>
                            </ul>
                        </div>

                        <div class="legend-section">
                            <strong>Precipitation Types</strong>
                            <ul class="legend-list">
                                <li><span class="icon icon-precip-drizzle" aria-hidden="true"></span>Drizzle (shallow stratus)</li>
                                <li><span class="icon icon-precip-rain" aria-hidden="true"></span>Rain (T &gt; 2°C)</li>
                                <li><span class="icon icon-precip-snow" aria-hidden="true"></span>Snow (T &lt; -5°C)</li>
                                <li><span class="icon icon-precip-sleet" aria-hidden="true"></span>Sleet (-5°C &lt; T &lt; 2°C)</li>
                                <li><span class="icon icon-precip-freezing" aria-hidden="true"></span>Freezing rain (surface ≤ 0°C)</li>
                                <li><span class="icon icon-precip-ice" aria-hidden="true"></span>Graupel (rimed ice pellets)</li>
                                <li><span class="icon icon-precip-hail" aria-hidden="true"></span>Hail (strong updraft storms)</li>
                            </ul>
                        </div>
                    </div>
                </details>
            </div>

            <div class="info-panel">
                <strong class="info-title">Tips</strong>
                <ul class="tips-list">
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Sand: Hot days, cold nights</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Clay: Stable temps, holds moisture</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Rock: Slow to heat/cool</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Loam: Balanced properties</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Wet soil = cooler (evaporation)</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Toggle soil view to see types</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Soil temp affects air temp</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Desert effect: sand + dry = extremes</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Clouds: Block sun, trap heat at night</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Orographic: Wind + mountains = clouds</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Afternoon: Convective clouds over hot areas</li>
                    <li><span class="icon icon-tip" aria-hidden="true"></span>Rain cools, snow insulates</li>
                </ul>
            </div>
        </aside>
    </div>

    <script type="module" src="/index.tsx"></script>
</body>
</html>
